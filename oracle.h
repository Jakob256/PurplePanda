/**************************
*** function depends on ***
**************************/

#include "globalVariables.h"

/************
*** Guard ***
************/

#ifndef oracleFILE
#define oracleFILE

/***************
*** Let's go ***
***************/

void oracle(int board[8][8],unsigned long long int key){
	
	/********************
	** PST from Tuning **
	********************/
	
	int PST_Pawn_mg[8][8]={
	{300,300,300,300,300,300,300,300},
	{180, 99,180,177,162, -6,153, -6},
	{ 39, 48, 72, 84, 90,111, 90, 66},
	{ 15, -3, -6,  9, 42, 33, 36, 12},
	{-18, -6,  3,  6,  9, -3, 12, -6},
	{-18,-18,-18,-15,-12,-15, 18,-12},
	{-18,-18,-18,-18,-18,  3, 24,-18},
	{  0,  0,  0,  0,  0,  0,  0,  0}};


	int PST_Rook_mg[8][8]={
	{ 37, 28, 33, -6, 45, 45, 15, 45},
	{-13, -9, 30, 43, 45, 45, 45, 45},
	{-27,  3, 15,-18, 45, 45, 45, 36},
	{-34, -7,  1, -9,  0,  3, 33,-12},
	{-34,-22,-37,-27,-19,-16, -7, -3},
	{-39,-36,-45,-28,-25,-25,  4,-25},
	{-37,-40,-31,-37,-30,-22,-10,-45},
	{-34,-30,-18,-22,-19,-25,-30,-34}};


	int PST_Knight_mg[8][8]={
	{-45, -3,-45, 18,-25,-45,-45,-45},
	{ 15, -1, 45, 37, 45, 45, 10, 45},
	{-25,  1, 30, 45, 45, 45, 45, 39},
	{ 21, 12, 18, 34, 10, 28, 22, 22},
	{-13,-27,  6, -7, -1, 22, 24, -7},
	{-27,-21,-12,-10,  3, -7, -3,-13},
	{-45,-45,-16,-15,-13,-10,-33,-27},
	{-45,-30,-40,-30,-33,-24,-21,-45}};


	int PST_Bishop_mg[8][8]={
	{-30, 33,-16,-45, 37,-45,-22,-45},
	{ 30,-16, 42, -9, 45, 45, 15, 33},
	{ 34, 30, 25, 45, 45, 45, 45, 45},
	{ 21, 16, 30, 45, 42, 37, 18, 16},
	{ 16, 25, 18, 34, 19, 24, 12, 19},
	{ 15, 19,  9, 15, 10,  3, 25, 18},
	{ 16, 16, 25,  0,  1, 13, 16, 16},
	{ -4, -4, -1,-30, -9, -4, 25,-12}};


	int PST_Queen_mg[8][8]={
	{  5, 45, 74, 95, 95, 95, 95, 95},
	{ 44, 21, 42, 93, 60, 95, 95, 95},
	{ 39, 48, 32, 68, 95, 95, 95, 93},
	{ 29, 23, 27, 47, 75, 68, 53, 57},
	{ 36, 56, 36, 38, 41, 36, 57, 45},
	{ 44, 38, 32, 21, 24, 30, 50, 51},
	{ 17, 36, 36, 38, 33, 50, 47, 63},
	{ 48, 29,  9, 30, 15,  5, 23, 35}};


	int PST_King_mg[8][8]={
	{ 37,-45, 45, 45, 21, 45, 45, 24},
	{-21,  0, 45, 45,-31, 45, 45, 45},
	{-45, 45, 45, 30,  6, 45, 45,-10},
	{-43, -6, 13, 24, 27, -6,-12,-45},
	{-45, 45,-36,  0,-16,-33,-45,-45},
	{ 27,-45,-12,-45,-45,-45,-42,-45},
	{ 45,-13,  1,-18,-12,-36,  9,  3},
	{  0, 30, 24,-42, 13,-31, 22, 24}};


	int PST_Pawn_eg[8][8]={
	{300,300,300,300,300,300,300,300},
	{147,141,156,102,138,162, 84,120},
	{117,111,120,108, 69, 69, 96,105},
	{ 57, 72, 60, 33, 30, 30, 54, 45},
	{ 36, 51,  9, 21, 15, 33, 39, 21},
	{ 12, 57, 27, 45, 57, 39, 39, 18},
	{ 27, 60, 42, 60, 69, 48, 45, 15},
	{  0,  0,  0,  0,  0,  0,  0,  0}};


	int PST_Rook_eg[8][8]={
	{ 18, 37, 22, 45, 21, 24, 39, 19},
	{ 42, 45, 43, 40, 31, 45, 39, 18},
	{ 34, 34, 28, 43,  9, 19, 13,  9},
	{ 42, 22, 27, 42, 24, 15, 15, 24},
	{ 19, 34, 42, 30, 22, 36, 25, 13},
	{ 13, 21, 13, 18, -3, 10, 16, 21},
	{ -3, 10,  9,  7,  6, -3,-10, 27},
	{ 10,  3,  3,  9,  6, 10,  7,  3}};


	int PST_Knight_eg[8][8]={
	{-45, -1, 12, -1, 13,  7, -9,-45},
	{ 12,  0,  0, 24, 10, 18, -6,  7},
	{ 21, 21, 22, 36, 45, 45, 31, 18},
	{ 12, 15, 19, 33, 43, 25, 27,  7},
	{-10, 33, 34, 42, 40, 36, 15, -1},
	{-28, -4, 12, 24, 13,  4, -9,-33},
	{-15,-10,-27, -1,-13, -7, 15,-25},
	{-45,-45,-34,-31,-10,-22,-43,-45}};


	int PST_Bishop_eg[8][8]={
	{ 45, 12,  0, 25,  1, 40,  6, 18},
	{  3, 15, -9, 19, -4, 21, 12, 21},
	{  6, 40,  9, 10, 30, 36, 37, 30},
	{ 22, 18, 25, 18, 21, 19, 10, 13},
	{-18, 19, 16, 13, 21, 12,  4,  4},
	{  0,  7, 28, 24, 30, 18, -9, 22},
	{-15,-12, -1,  3, 18,-13,  4, -6},
	{  3,-25,-12,  9,-12, -1,-12,-22}};


	int PST_Queen_eg[8][8]={
	{ 21, 45, 30, 22, 37, 45, 45, 22},
	{-19, 37, 39,-13, 45, 45, 45, 40},
	{  9,-10, 30, 12, 45, 45, 45, 15},
	{ 33, 30, 25, 45, 45, 45, 45, 42},
	{ -7,-33, 31, 45, 45, 45, -3,  9},
	{ -9,-22, 22, 25, 25, 18,-18,-45},
	{ 18, -7,-33,-18,-19,-37,-45,-45},
	{-36,-45,-30,-43, -9,-28, -6, 27}};


	int PST_King_eg[8][8]={
	{-45,-45,-22, -9,-19, 10,-19,-45},
	{ 19,  0, 34, 36, 28, 40, 42,-12},
	{ -9, 40, 45, 39, 45, 45, 39, 21},
	{  7, 31, 36, 43, 45, 42, 37,  1},
	{ -4, 19, 28, 34, 34, 24, 21, -3},
	{-27, -1,  0, 13, 16, 12,  0,-10},
	{-39, -6, -6, -3,  4,  3, -6,-16},
	{-22,-16,-24,-12,-45,-13,-13,-45}};


	/*************************
	*** Further processing ***
	*************************/
	
	
	for (int i=0; i<8;i++){
		for (int j=0; j<8;j++){
			for (int piece=-6; piece < 7; piece++){

				if (piece==-6){ PST_mg[6+piece][i][j] =-PST_King_mg[j][i];}				
				if (piece==-5){ PST_mg[6+piece][i][j] =-PST_Queen_mg[j][i];}
				if (piece==-4){ PST_mg[6+piece][i][j] =-PST_Bishop_mg[j][i];}
				if (piece==-3){ PST_mg[6+piece][i][j] =-PST_Knight_mg[j][i];}
				if (piece==-2){ PST_mg[6+piece][i][j] =-PST_Rook_mg[j][i];}
				if (piece==-1){ PST_mg[6+piece][i][j] =-PST_Pawn_mg[j][i];}
				if (piece== 0){ PST_mg[6+piece][i][j] = 0;}
				if (piece== 1){ PST_mg[6+piece][i][j] = PST_Pawn_mg[7-j][i];}
				if (piece== 2){ PST_mg[6+piece][i][j] = PST_Rook_mg[7-j][i];}
				if (piece== 3){ PST_mg[6+piece][i][j] = PST_Knight_mg[7-j][i];}
				if (piece== 4){ PST_mg[6+piece][i][j] = PST_Bishop_mg[7-j][i];}
				if (piece== 5){ PST_mg[6+piece][i][j] = PST_Queen_mg[7-j][i];}
				if (piece== 6){ PST_mg[6+piece][i][j] = PST_King_mg[7-j][i];}
				
				
				if (piece==-6){ PST_eg[6+piece][i][j] =-PST_King_eg[j][i];}				
				if (piece==-5){ PST_eg[6+piece][i][j] =-PST_Queen_eg[j][i];}
				if (piece==-4){ PST_eg[6+piece][i][j] =-PST_Bishop_eg[j][i];}
				if (piece==-3){ PST_eg[6+piece][i][j] =-PST_Knight_eg[j][i];}
				if (piece==-2){ PST_eg[6+piece][i][j] =-PST_Rook_eg[j][i];}
				if (piece==-1){ PST_eg[6+piece][i][j] =-PST_Pawn_eg[j][i];}
				if (piece== 0){ PST_eg[6+piece][i][j] = 0;}
				if (piece== 1){ PST_eg[6+piece][i][j] = PST_Pawn_eg[7-j][i];}
				if (piece== 2){ PST_eg[6+piece][i][j] = PST_Rook_eg[7-j][i];}
				if (piece== 3){ PST_eg[6+piece][i][j] = PST_Knight_eg[7-j][i];}
				if (piece== 4){ PST_eg[6+piece][i][j] = PST_Bishop_eg[7-j][i];}
				if (piece== 5){ PST_eg[6+piece][i][j] = PST_Queen_eg[7-j][i];}
				if (piece== 6){ PST_eg[6+piece][i][j] = PST_King_eg[7-j][i];}
				
				
			}
		}
	}
	
	/******************************
	*** Only one pawn remaining ***
	******************************/
	
	int piece, colPawn, rowPawn, colorPawn, nrPawns=0;
	for (int col=0;col<8;col++){
		for (int row=0;row<8;row++){
			piece=board[col][row];
			if (abs(piece)==1){nrPawns+=1;colPawn=col;rowPawn=row;colorPawn=piece;}
		}
	}
	
	if (nrPawns==1){
		for (int col=0;col<8;col++){
			for (int row=0;row<8;row++){
				for (int piece=-6;piece<=6;piece++){PST_eg[6+piece][col][row]=0;}
				for (int piece=-6;piece<=6;piece++){PST_eg[6+piece][col][row]=0;}
				PST_eg[6+1][col][row]=row*30;
				PST_eg[6-1][col][row]=-(7-row)*30;
				
				
				if ((row>rowPawn && colorPawn==1) || (row<rowPawn && colorPawn==-1)){ // in front of the pawn
					PST_eg[6-6][col][row]= -(64-abs(col-colPawn)*8);
					PST_eg[6+6][col][row]= +(64-abs(col-colPawn)*8);
				} else {
					PST_eg[6-6][col][row]= -(64-8*max(abs(col-colPawn),abs(row-rowPawn-colorPawn)));
					PST_eg[6+6][col][row]= +(64-8*max(abs(col-colPawn),abs(row-rowPawn-colorPawn)));
				}
				
				// copy to middlegame pst
				for (int piece=-6;piece<=6;piece++){PST_mg[6+piece][col][row]=PST_eg[6+piece][col][row];}
				
				
			}
		}
	}
	
	
	/**************
	*** flatten ***
	**************/
	
	
	for (int i=0; i<8;i++){
		for (int j=0; j<8;j++){
			for (int piece=-6; piece<7; piece++){
				PST_mg_vector[6+piece+13*i+13*8*j]=PST_mg[6+piece][i][j];
				PST_eg_vector[6+piece+13*i+13*8*j]=PST_eg[6+piece][i][j];
			}
		}
	}
	
}
	
#endif